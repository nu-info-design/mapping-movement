<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Disaster-Induced Internal Displacements</title>

  <!-- D3 & TopoJSON Libraries -->
  <script src="Assets/d3.v7.min.js"></script>
  <script src="Assets/topojson.js"></script>

  <!-- Fonts & CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Inter&family=Poppins&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- AOS Animation Library -->
  <link href="Assets/aos.css" rel="stylesheet">
</head>

<body>
  <section class="intro-split" data-aos="fade-up">
    <div class="intro-left">
      <h1>Disaster-Induced Internal Displacements</h1>
      <h2>in 2023</h2>
    </div>
    <div class="intro-right">
      <p>
        In 2023, over 24 million people were displaced within their own countries, driven by powerful natural disasters such as floods, storms, earthquakes, and wildfires. The top five most affected countries — China, Türkiye, Philippines, Somalia, and Pakistan — saw the largest movements of people, with millions forced to leave their homes in the wake of these devastating events. This visualization highlights the scale of displacement in these regions, offering insights into how these disasters triggered widespread human movement and impacted communities across the globe.
      </p>
    </div>
  </section>

  <section data-aos="fade-up" data-aos-delay="200">
    <div class="section">
      <div class="filters">
        <label for="hazardFilter">Filter by Hazard:</label>
        <select id="hazardFilter"></select>

        <label for="sizeFilter">Minimum Displacement:</label>
        <input type="range" id="sizeFilter" min="0" max="10000000" value="1" step="10000" />
        <span id="sizeValue">1</span>
      </div>
      <svg id="bubbleMap" viewBox="0 0 900 500" preserveAspectRatio="xMidYMid meet">
  <g id="sizeLegend" transform="translate(700, 320)"></g>
        
      </svg>
      <div id="hoverBox" class="hover-box" style="display:none; position:absolute; pointer-events:none;"></div>
    </div>
  </section>

  <p data-aos="fade-up" data-aos-delay="300" style="
    max-width: 1000px; 
    margin: 3rem auto; 
    text-align: center; 
    font-size: 16px; 
    line-height: 1.8; 
    color: #cbd5e1;
    padding: 0 2rem;">
    While the map offers a sweeping view of disaster-induced displacement across the globe, the visualization below focuses on the <em>most affected countries</em>. It breaks down not just the total number of displaced people, but also the specific hazards — such as floods, storms, earthquakes, wildfires, and droughts — that caused them.
    <br><br>
    Each row represents a country, with colored bubbles that reflect the type and scale of disasters endured. Larger clusters signal greater impact, while the colors reveal which hazards are most dominant. By toggling the grouping, you can shift from a randomized spread to a hazard-based arrangement — allowing patterns to emerge and comparisons to be drawn.
    <br><br>
    This layered chart moves us from global context to focused insight, helping uncover how different disasters disrupt lives differently across regions.
  </p>

  <section data-aos="fade-up" data-aos-delay="400">
    <div class="chart-container">
      <svg id="clusterChart" width="900" height="2000"></svg>
      
    </div>
  </section>

  <!-- JS Scripts -->
  <script src="final_script.js"></script>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({
      duration: 1000,
      easing: 'ease-in-out',
      once: true
    });

    function checkIfChartIsVisible() {
      const mapElement = document.getElementById("bubbleMap");
      const barChartElement = document.getElementById("clusterChart");
      const legend = document.querySelector(".legend-vertical");

      const mapRect = mapElement.getBoundingClientRect();
      const barChartRect = barChartElement.getBoundingClientRect();

      const isMapVisible = mapRect.top < window.innerHeight && mapRect.bottom >= 0;
      const isBarChartVisible = barChartRect.top < window.innerHeight && barChartRect.bottom >= 0;

      if (isMapVisible || isBarChartVisible) {
        legend.style.visibility = 'visible';
        setTimeout(() => {
          legend.style.opacity = 1;
        }, 10);
      } else {
        legend.style.opacity = 0;
        setTimeout(() => {
          legend.style.visibility = 'hidden';
        }, 1000);
      }
    }

    window.addEventListener('scroll', checkIfChartIsVisible);
    checkIfChartIsVisible();

    // Patch for cluster chart animation
    function animateClusterBubbles() {
      d3.selectAll("circle")
        .transition()
        .duration(100)
        .attr("cx", d => d.cx)
        .attr("cy", d => d.cy)
        .attr("r", d => d.r);
    }
    window.toggleGrouping = function() {
      groupByType = !groupByType;
      drawBubbles();
      setTimeout(() => animateClusterBubbles(), 10000000);
    }
   

  </script>
  <script src="../assets/nav.js"></script>

</body>
</html>
